{% extends "base.html" %}

{% block title %}ЁЯПЖ ржирж┐рж░рзНржмрж╛ржЪржирзА ржлрж▓рж╛ржлрж▓ - ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ ржЬржиржоржд рж╕ржВржЧрзНрж░рж╣{% endblock %}

{% block content %}
<div style="text-align: center; margin-bottom: 30px;">
    <h1>ЁЯПЖ ржирж┐рж░рзНржмрж╛ржЪржирзА ржлрж▓рж╛ржлрж▓</h1>
    {% if total_votes > 0 %}
    <div style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; margin: 20px 0;">
        <p style="font-size: 18px; color: #FFD700;">ЁЯУК рж░рж┐ржпрж╝рзЗрж▓ ржЯрж╛ржЗржо ржлрж▓рж╛ржлрж▓ | тЪб рждрж╛рзОржХрзНрж╖ржгрж┐ржХ ржЖржкржбрзЗржЯ</p>
        <p style="font-size: 16px;">ржорзЛржЯ ржнрзЛржЯ: {{ total_votes }} ЁЯСе</p>
    </div>
    {% endif %}
</div>

<div id="results-container">
    <div class="loading pulse">ржлрж▓рж╛ржлрж▓ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</div>
</div>

{% if not has_voted %}
<a href="/" class="back-btn">тЖР ржкрзВрж░рзНржмрзЗрж░ ржкрж╛рждрж╛ржпрж╝ ржпрж╛ржи</a>
{% endif %}

<div
    style="text-align: center; margin-top: 30px; background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px;">
    <h3 style="color: #FFD700;">ЁЯУ▒ ржмржирзНржзрзБржжрзЗрж░ рж╕рж╛ржерзЗ рж╢рзЗржпрж╝рж╛рж░ ржХрж░рзБржи!</h3>
    <p>ржЖрж░рзЛ ржорж╛ржирзБрж╖ржХрзЗ ржнрзЛржЯ ржжрж┐рждрзЗ ржЙрзОрж╕рж╛рж╣рж┐ржд ржХрж░рзБржи ржПржмржВ ржЖрж╕рж▓ ржЬржиржоржд ржЬрж╛ржирзБржи!</p>
    <div style="margin: 15px 0;">
        <button onclick="shareOnFacebook()" class="party-button"
            style="display: inline-block; width: auto; margin: 5px; padding: 10px 20px;">
            ЁЯУШ Facebook ржП рж╢рзЗржпрж╝рж╛рж░ ржХрж░рзБржи
        </button>
        <button onclick="shareOnWhatsApp()" class="party-button"
            style="display: inline-block; width: auto; margin: 5px; padding: 10px 20px;">
            ЁЯТм WhatsApp ржП рж╢рзЗржпрж╝рж╛рж░ ржХрж░рзБржи
        </button>
        <button onclick="copyLink()" class="party-button"
            style="display: inline-block; width: auto; margin: 5px; padding: 10px 20px;">
            ЁЯФЧ рж▓рж┐ржВржХ ржХржкрж┐ ржХрж░рзБржи
        </button>
    </div>
</div>

<script>
    function updateResults() {
        fetch('/api/results')
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(data => {
                const container = document.getElementById('results-container');
                container.innerHTML = '';

                // Update total votes display
                const totalVotesDisplay = document.getElementById('total-votes-display');
                if (totalVotesDisplay) {
                    totalVotesDisplay.textContent = data.total_votes;
                }

                data.rankings.forEach((item, index) => {
                    const card = document.createElement('div');
                    card.className = `results-card rank-${item.rank}`;

                    const rankEmojis = ['ЁЯеЗ', 'ЁЯеИ', 'ЁЯеЙ', 'ЁЯШв', 'ЁЯТФ'];
                    const rankEmoji = rankEmojis[item.rank - 1] || 'ЁЯТФ';

                    card.innerHTML = `
                        <img src="${item.meme}" alt="Rank ${item.rank} meme" class="meme-img">
                        <h3>${rankEmoji} ${item.rank === 1 ? 'WINNER' : item.rank + getSuffix(item.rank) + ' Place'}</h3>
                        <h4>${item.party}</h4>
                        <div class="vote-count">${item.votes} ржнрзЛржЯ</div>
                        <div style="clear: both;"></div>
                    `;

                    container.appendChild(card);
                });
            })
            .catch(error => {
                console.error('Error loading results:', error);
                document.getElementById('results-container').innerHTML =
                    '<div style="color: #FF6B6B;">ржлрж▓рж╛ржлрж▓ рж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржЪрзНржЫрзЗред ржкрзБржирж░рж╛ржпрж╝ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред</div>';
            });
    }

    function getSuffix(rank) {
        if (rank === 1) return 'st';
        if (rank === 2) return 'nd';
        if (rank === 3) return 'rd';
        return 'th';
    }

    // Social sharing functions
    function shareOnFacebook() {
        const url = encodeURIComponent(window.location.origin);
        const text = encodeURIComponent('ЁЯЧ│я╕П ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ ржЬржиржоржд рж╕ржВржЧрзНрж░рж╣рзЗ ржЖржорж┐ ржнрзЛржЯ ржжрж┐ржпрж╝рзЗржЫрж┐! рждрзБржорж┐ржУ ржжрж╛ржУ ржПржмржВ ржжрзЗржЦрзЛ ржХрзЛржи ржжрж▓ ржПржЧрж┐ржпрж╝рзЗ ржЖржЫрзЗ! ЁЯФе');
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
    }

    function shareOnWhatsApp() {
        const url = encodeURIComponent(window.location.origin);
        const text = encodeURIComponent('ЁЯЧ│я╕П ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ ржЬржиржоржд рж╕ржВржЧрзНрж░рж╣!\n\nЁЯФе ржПржЦржиржЗ ржнрзЛржЯ ржжрж┐ржи ржПржмржВ рж░рж┐ржпрж╝рзЗрж▓ ржЯрж╛ржЗржо ржлрж▓рж╛ржлрж▓ ржжрзЗржЦрзБржи!\nЁЯУК ржХрзЛржи ржжрж▓ ржПржЧрж┐ржпрж╝рзЗ ржЖржЫрзЗ ржЬрж╛ржирзБржи!\n\n');
        window.open(`https://wa.me/?text=${text}${url}`, '_blank');
    }

    function copyLink() {
        navigator.clipboard.writeText(window.location.origin).then(() => {
            alert('тЬЕ рж▓рж┐ржВржХ ржХржкрж┐ рж╣ржпрж╝рзЗржЫрзЗ! ржПржЦржи ржпрзЗржХрзЛржирзЛ ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝ рж╢рзЗржпрж╝рж╛рж░ ржХрж░рзБржи!');
        });
    }

    // Initial load
    updateResults();

    // Auto refresh every 5 seconds for real-time updates
    setInterval(updateResults, 5000);
</script>
{% endblock %}